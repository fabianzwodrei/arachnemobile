// Generated by CoffeeScript 1.6.3
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['../../controller/controller', '../../collections/cmsMenuCollection', '../../models/cmsNode', 'text!../../../layouts/cmsMenu.html', 'text!../../../templates/cmsSubMenu.html', 'text!../../../templates/cmsTeaser.html'], function(Controller, CmsMenuCollection, CmsNode, Layout, CmsSubMenuTemplate, CmsTeaserTemplate) {
    var CmsMenuController, _ref;
    return CmsMenuController = (function(_super) {
      __extends(CmsMenuController, _super);

      function CmsMenuController() {
        _ref = CmsMenuController.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      CmsMenuController.prototype.className = 'container';

      CmsMenuController.prototype.id = 'cmsMenu-view';

      CmsMenuController.prototype.layout = _.template(Layout);

      CmsMenuController.prototype.cmsSubMenuTemplate = _.template(CmsSubMenuTemplate);

      CmsMenuController.prototype.cmsTeaserTemplate = _.template(CmsTeaserTemplate);

      CmsMenuController.prototype.events = {
        'click .cms-menu-item': 'selectMenuItem',
        'hover .cms-submenu-item': 'selectTeaserItem',
        'click .cms-submenu-item': 'clickedTeaserItem'
      };

      CmsMenuController.prototype.initialize = function(params) {
        this.collection = new CmsMenuCollection();
        this.collection.bind('reset', this.render, this);
        return this.collection.fetch();
      };

      CmsMenuController.prototype.render = function(event) {
        return $(this.el).html(this.layout({
          collection: this.collection.rootItems
        }));
      };

      CmsMenuController.prototype.renderSubMenu = function(id) {
        var childs, subMenuDiv;
        childs = this.collection.getChilds(id);
        subMenuDiv = $(this.el).find('#cmsSubMenu');
        $(subMenuDiv).empty();
        return $(subMenuDiv).append(this.cmsSubMenuTemplate({
          items: childs
        }));
      };

      CmsMenuController.prototype.renderTeaser = function(event) {
        var cmsTeaser;
        cmsTeaser = $(this.el).find('#cmsTeaser');
        $(cmsTeaser).empty();
        return $(cmsTeaser).append(this.cmsTeaserTemplate({
          cmsNode: event.toJSON()
        }));
      };

      CmsMenuController.prototype.selectMenuItem = function(event) {
        $(this.el).find('.cms-menu-item').removeClass('active');
        $(this.el).find('#' + event.target.id).addClass('active');
        this.renderSubMenu(event.target.id);
        return event.preventDefault();
      };

      CmsMenuController.prototype.selectTeaserItem = function(event) {
        this.teaserNode = new CmsNode({
          id: event.target.id
        });
        this.teaserNode.bind('change', this.renderTeaser, this);
        this.teaserNode.fetch();
        return event.preventDefault();
      };

      CmsMenuController.prototype.clickedTeaserItem = function(event) {
        return console.log("clickedTeaserItem");
      };

      CmsMenuController.prototype.release = function() {
        this.undelegateEvents();
        return this.remove();
      };

      return CmsMenuController;

    })(Controller);
  });

}).call(this);
